name: Vite build and commit to release branch
on:
  push:
    branches:
      - develop
    # paths: ['stories/**', 'src/components/**'] # Trigger the action only when files change in the folders defined here
permissions:
  contents: write
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    steps:
      - name: â¤µï¸ Checkout
        uses: actions/checkout@v4
        with:
          ref: develop
      - name: ğŸ§° NPM Install
        run: |
          npm ci
          npm i @rollup/rollup-linux-x64-gnu
      - name: ğŸ”¨ Vite Build
        run: |
          npm run build
          echo 'RELEASE' > release.txt
      - name: âœï¸ Commit to release branch
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git checkout --orphan release
          git rm -rf ./src ./public
          git status
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git add .
          git commit -am "Vite build ğŸ”¨"
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git status
          ls -ha
          ls -ha dist
      - name: ğŸ«¸ Push release branch to origin
        run: |
          git push origin release

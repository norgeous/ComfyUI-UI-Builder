name: Vite build and commit to release branch
on:
  push:
    branches:
      - develop
    # paths: ['stories/**', 'src/components/**'] # Trigger the action only when files change in the folders defined here
permissions:
  contents: write
  issues: write
  pull-requests: write
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    steps:
      - name: ‚§µÔ∏è Checkout
        uses: actions/checkout@v4
        with:
          ref: develop
          # token: ${{ secrets.WORKFLOW_GIT_ACCESS_TOKEN }}
          token: ${{ github.token }}
      - name: üß∞ NPM Install
        run: |
          npm ci
          npm i @rollup/rollup-linux-x64-gnu
      - name: üî® Vite Build
        run: |
          npm run build
          echo 'RELEASE' > README.md
      - name: ‚úçÔ∏è Commit to release branch
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git checkout --orphan release
          # git rm -rf ./.github ./.storybook ./.vscode ./public ./src
          # git rm -f  .eslintrc.cjs .gitattributes .gitignore README.md TODO.md index.html jsconfig.json package-lock.json package.json prettier.config.js vite.config.js
          # git rm -rf ./node_modules
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git status
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git rm -f .gitignore
          # git rm -rf .
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git status
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          # git add __init__.py
          # git add README.md
          git add dist/
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git commit -m "Vite build üî®"
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          git status
          echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
          ls -ha
          git show --summary
      - name: ü´∏ Push release branch to origin
        run: |
          git remote set-url origin https://x-access-token:${{ github.token }}@github.com/$GITHUB_REPOSITORY          
          git push origin release
          # git push

      # - name: ü´∏ Commit changes
      #   uses: EndBug/add-and-commit@v9
      #   with:
      #     author_name: Your Name
      #     author_email: mail@example.com
      #     message: 'Your commit message'
      #     add: 'report.txt'

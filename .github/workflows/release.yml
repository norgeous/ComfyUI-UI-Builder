name: Vite build and commit to release branch
on:
  push:
    branches:
      - develop
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      # id-token: write
    steps:
      - name: â¤µï¸ Checkout "develop" branch
        uses: actions/checkout@v4
        with:
          ref: develop

      - name: ğŸ§° NPM Install
        run: |
          npm ci
          npm i @rollup/rollup-linux-x64-gnu

      - name: ğŸ‡» Vite Build
        run: |
          npm run build

      - name: ğŸ“‹ Prepare orphan "release" branch
        run: |
          git checkout --orphan release
          git rm -rf .github/workflows .storybook .vscode public src
          git rm -f  .eslintrc.cjs .gitattributes .gitignore TODO.md index.html jsconfig.json package-lock.json package.json prettier.config.js vite.config.js

      - name: ğŸ‘¤ Setup git user
        run: |
          # git remote set-url origin https://x-access-token:${{ github.token }}@github.com/$GITHUB_REPOSITORY
          git config user.name github-actions
          git config user.email github-actions@github.com

      - name: âœï¸ Commit to "release" branch
        run: |
          git add dist/
          git add README.md
          git commit -m "ğŸ‡» Vite Build"

      - name: ğŸ«¸ Force push "release" branch to origin
        run: |
          git push origin release --force

      # - name: âœï¸ Commit to release branch
      #   run: |
      #     git config user.name github-actions
      #     git config user.email github-actions@github.com
      #     git checkout --orphan release
      #     # git rm -rf ./.github ./.storybook ./.vscode ./public ./src
      #     # git rm -f  .eslintrc.cjs .gitattributes .gitignore README.md TODO.md index.html jsconfig.json package-lock.json package.json prettier.config.js vite.config.js
      #     # git rm -rf ./node_modules
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     git status
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     git rm -f .gitignore
      #     # git rm -rf .
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     git status
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     # git add __init__.py
      #     # git add README.md
      #     git add dist/
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     git commit -m "Vite build ğŸ”¨"
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     git status
      #     echo "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"
      #     ls -ha
      #     git show --summary

      # - name: ğŸ«¸ Commit changes
      #   uses: EndBug/add-and-commit@v9
      #   with:
      #     author_name: github-actions
      #     author_email: github-actions@github.com
      #     message: 'Vite build ğŸ”¨'
      #     add: 'dist'
